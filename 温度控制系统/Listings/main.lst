C51 COMPILER V9.54   MAIN                                                                  07/05/2025 06:49:05 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: E:\Keil5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main.l
                    -st) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGX52.H>
   2          #include "LCD1602.h"
   3          #include "DS18B20.h"
   4          #include "Delay.h"
   5          #include "AT24C02.h"
   6          #include "Key.h"
   7          #include "Timer0.h"
   8          #include "Buzzer.h"
   9          
  10          sbit LED1=P2^0; //定义LED D1，连接到P2.0引脚
  11          sbit LED2=P2^1; //定义LED D2，连接到P2.1引脚
  12          
  13          float T,TShow;
  14          char TLow,THigh;
  15          unsigned char KeyNum;
  16          unsigned char AlarmFlag = 0;            //报警标志位
  17          unsigned int AlarmCount = 0;            //报警计数器
  18          
  19          void main()
  20          {
  21   1      
  22   1              //初始化LED状态
  23   1              LED1=1; //LED D1初始熄灭
  24   1              LED2=1; //LED D2初始熄灭
  25   1              
  26   1              DS18B20_ConvertT();             //上电先转换一次温度，防止第一次读数据错误
  27   1              Delay(1000);                    //等待转换完成
  28   1              THigh=AT24C02_ReadByte(0);      //读取温度阈值数据
  29   1              TLow=AT24C02_ReadByte(1);
  30   1              if(THigh>125 || TLow<-55 || THigh<=TLow)
  31   1              {
  32   2                      THigh=20;                       //如果阈值非法，则设为默认值
  33   2                      TLow=15;
  34   2              }
  35   1              LCD_Init();
  36   1              LCD_ShowString(1,1,"T:");
  37   1              LCD_ShowString(2,1,"TH:");
  38   1              LCD_ShowString(2,9,"TL:");
  39   1              LCD_ShowSignedNum(2,4,THigh,3);
  40   1              LCD_ShowSignedNum(2,12,TLow,3);
  41   1              Timer0_Init();
  42   1              
  43   1              while(1)
  44   1              {
  45   2                      KeyNum=Key();
  46   2                      
  47   2                      /*温度读取及显示*/
  48   2                      DS18B20_ConvertT();     //转换温度
  49   2                      T=DS18B20_ReadT();      //读取温度
  50   2                      if(T<0)                         //如果温度小于0
  51   2                      {
  52   3                              LCD_ShowChar(1,3,'-');  //显示负号
  53   3                              TShow=-T;               //将温度变为正数
  54   3                      }
C51 COMPILER V9.54   MAIN                                                                  07/05/2025 06:49:05 PAGE 2   

  55   2                      else                            //如果温度大于等于0
  56   2                      {
  57   3                              LCD_ShowChar(1,3,'+');  //显示正号
  58   3                              TShow=T;
  59   3                      }
  60   2                      LCD_ShowNum(1,4,TShow,3);               //显示温度整数部分
  61   2                      LCD_ShowChar(1,7,'.');          //显示小数点
  62   2                      LCD_ShowNum(1,8,(unsigned long)(TShow*100)%100,2);//显示温度小数部分(2位小数)
  63   2                      
  64   2                      /*阈值判断及显示*/
  65   2                      if(KeyNum)
  66   2                      {
  67   3                              if(KeyNum==1)   //K1按键，THigh自增
  68   3                              {
  69   4                                      THigh++;
  70   4                                      if(THigh>125){THigh=125;}
  71   4                              }
  72   3                              if(KeyNum==2)   //K2按键，THigh自减
  73   3                              {
  74   4                                      THigh--;
  75   4                                      if(THigh<=TLow){THigh++;}//如果THigh小于等于TLow，则不允许自减
  76   4                              }
  77   3                              if(KeyNum==3)   //K3按键，TLow自增
  78   3                              {
  79   4                                      TLow++;
  80   4                                      if(TLow>=THigh){TLow--;}//如果TLow大于等于THigh，则不允许自增
  81   4                              }
  82   3                              if(KeyNum==4)   //K4按键，TLow自减
  83   3                              {
  84   4                                      TLow--;
  85   4                                      if(TLow<-55){TLow=-55;}
  86   4                              }
  87   3                              LCD_ShowSignedNum(2,4,THigh,3); //显示阈值数据
  88   3                              LCD_ShowSignedNum(2,12,TLow,3);
  89   3                              AT24C02_WriteByte(0,THigh);             //写入到At24C02中保存
  90   3                              Delay(5);
  91   3                              AT24C02_WriteByte(1,TLow);
  92   3                              Delay(5);
  93   3                      }
  94   2                      
  95   2                      /*温度状态判断及LED控制*/
  96   2                      if(T>THigh)                     //越界判断
  97   2                      {
  98   3                              LCD_ShowString(1,13,"OV:H");
  99   3                              AlarmFlag = 1;          //设置高温报警标志
 100   3                              LED1 = 1;                       //高温时LED D1熄灭
 101   3                              LED2 = 1;                       //高温时LED D2熄灭
 102   3                      }
 103   2                      else if(T<TLow)
 104   2                      {
 105   3                              LCD_ShowString(1,13,"OV:L");
 106   3                              AlarmFlag = 0;          //低温不报警，清除报警标志
 107   3                              LED1 = 0;                       //低温时LED D1常亮
 108   3                              LED2 = 1;                       //低温时LED D2熄灭
 109   3                      }
 110   2                      else
 111   2                      {
 112   3                              LCD_ShowString(1,13,"    ");
 113   3                              AlarmFlag = 0;          //正常温度，清除报警标志
 114   3                              LED1 = 1;                       //正常温度时LED D1熄灭
 115   3                              LED2 = 0;                       //正常温度时LED D2常亮
 116   3                      }
C51 COMPILER V9.54   MAIN                                                                  07/05/2025 06:49:05 PAGE 3   

 117   2              }
 118   1      }
 119          
 120          void Timer0_Routine() interrupt 1
 121          {
 122   1              static unsigned int T0Count;
 123   1              TL0 = 0x18;             //设置定时初值
 124   1              TH0 = 0xFC;             //设置定时初值
 125   1              T0Count++;
 126   1              if(T0Count>=20)
 127   1              {
 128   2                      T0Count=0;
 129   2                      Key_Loop();     //每20ms调用一次按键驱动函数
 130   2              }
 131   1              
 132   1              //蜂鸣器报警逻辑
 133   1              if(AlarmFlag)           //如果有高温报警
 134   1              {
 135   2                      AlarmCount++;
 136   2                      if(AlarmCount >= 500)   //每500ms响一次（500*1ms）
 137   2                      {
 138   3                              AlarmCount = 0;
 139   3                              Buzzer_Time(200);       //蜂鸣器响200ms
 140   3                      }
 141   2              }
 142   1              else
 143   1              {
 144   2                      AlarmCount = 0;         //清除计数器
 145   2              }
 146   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    704    ----
   CONSTANT SIZE    =     26    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     16    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
